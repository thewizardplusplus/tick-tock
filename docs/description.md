### ![](logo/logo.png) Общее описание

Tick-tock — интерпретируемый высокоуровневый язык программирования. Представляет собой конкурентную (по модели акторов) машину Тьюринга.

#### Исходники

Файлы исходного кода должны быть в кодировке UTF-8 и иметь концы строк как в UNIX (LF).

#### Ключевые слова

6 ключевых слов: `actor`, `state`, `message`, `let`, `send`, `set`.

#### Типы

Типизация: строгая динамическая.

Менеджмент памяти: сборка мусора.

##### Нулевой тип

Название: nil.

Тип: фиктивный тип; не хранит значение, а служит маркером его отсутствия; существует единственное значение данного типа.

Копирование: по значению.

Хранение: на стеке.

Определение: значение данного типа доступно через вызов функции рантайма `nil`.

##### Вещественные числа

Название: num.

Тип: с плавающей запятой, 8 байт.

Копирование: по значению.

Хранение: на стеке.

Определение:

- целые — `/\b((0x[\da-f]+)|(0[0-7]+)|(\d+(e\d+)?)|(\d+e[\+\-]\d+))\b/i`;
- вещественные — `/(\.\d+(e[\+\-]\d+)?)\b|\b\d+\.\d*((e[\+\-]\d+)?\b)?/i`.

##### Списки

Название: list.

Тип: LISP-подобный список &mdash; или пустой список, или пара из головы и хвоста, где голова может иметь любой тип (и является хранимым элементом), а хвост является аналогичным списком.

Копирование: по ссылке.

Хранение:

- ссылки &mdash; на стеке;
- значения &mdash; в куче.

Определение:

- пустого списка &mdash; через оператор `[...]` или вызов функции рантайма `__empty_list__`;
- списка из головы и хвоста &mdash; через оператор `:` или вызов функции рантайма `__cons__`;
- списка из набора элементов &mdash; через оператор `[...]`.

Доступ к элементам:

- к количеству элементов &mdash; через вызов функции рантайма `size`;
- к голове списка &mdash; через вызов функции рантайма `head`;
- к хвосту списка &mdash; через вызов функции рантайма `tail`;
- к элементу по индексу &mdash; через оператор `...[...]` или вызов функции рантайма `__item__`.

##### Строки

Строками являются списки, хранящие коды символов. Используется кодировка UTF-32.

Определение:

- интерпретируемые — `/"(\\x[\da-f]{2}|\\.|[^"\n])*?"/i`;
- сырые — `` /`[^`]*?`/ ``.

В интерпретируемых преобразуются управляющие последовательности.

##### Логический тип

В качестве значений логического типа используются значения других типов:

- ложным логическим значением являются:
  - значение `nil`;
  - число 0;
  - пустой список;
- истинным логическим значением являются:
  - числа, отличные от 0;
  - непустые списки.

#### Сущности

##### Обработчики сообщений

Содержат имя обрабатываемого сообщения и список команд, которые необходимо выполнить при получении данного сообщения.

Объявление:

```
"message", identifier,
  command, {command},
";"
```

Здесь `identifier` — имя обрабатываемого сообщения.

##### Состояния

Содержат имя состояния актора и список обработчиков сообщений, относящихся к этому состоянию.

Объявление:

```
"state", identifier,
  message, {message},
";"
```

Здесь `identifier` — имя состояния актора.

##### Акторы

Представляют собой зелёные (легковесные) потоки. Содержат список поддерживаемых состояний. По умолчанию находятся в состоянии `__initialization__`.

Объявление:

```
"actor",
  state, {state},
";"
```

#### Команды

##### Команда `let`

Вычисляет выражение, результат вычисления устанавливает указанной переменной. Если такой переменной ещё нет, то она будет объявлена. Изменение значения переменной, равно как и её объявление, имеет эффект только ниже текущей команды. Операция синхронная.

Синтаксис:

```
"let", identifier, "=", expression
```

Здесь `identifier` — имя переменной.

##### Команда `send`

Отправляет указанное сообщение всем акторам. Операция асинхронная.

Синтаксис:

```
"send", identifier
```

Здесь `identifier` — имя сообщения.

##### Команда `set`

Устанавливает указанное состояние текущему актору. Операция синхронная.

Синтаксис:

```
"set", identifier
```

Здесь `identifier` — имя состояния.

##### Выражение

Выражение может выступать в роли команды. В этом случае оно просто вычисляется, а результат вычисления отбрасывается. Может использоваться ради побочных эффектов вычисления. Операция синхронная.

#### Операции

Перечислены в порядке убывания приоритета.

| Приоритет | Операция   | Описание                               | Ассоциативность | Типы             | Функция    |
| --------- | ---------- | -------------------------------------- | --------------- | ---------------- | ---------- |
| 0         | `(...)`    | вложенное выражение                    | —               | —                | —          |
| 0         | `[...]`    | определение списка из набора элементов | —               | —                | —          |
| 0         | `...(...)` | вызов функции                          | —               | —                | —          |
| 1         | `...[...]` | доступ к элементам списка              | левая           | список + число   | `__item__` |
| 2         | `-`        | унарный минус                          | правая          | число            | `__neg__`  |
| 2         | `!`        | логическое отрицание                   | правая          | любой            | `__not__`  |
| 3         | `*`        | умножение                              | левая           | числа            | `__mul__`  |
| 3         | `/`        | деление                                | левая           | числа            | `__div__`  |
| 3         | `%`        | остаток от деления                     | левая           | числа            | `__mod__`  |
| 4         | `+`        | сложение/конкатенация                  | левая           | числа/списки     | `__add__`  |
| 4         | `-`        | вычитание                              | левая           | числа            | `__sub__`  |
| 5         | `<`        | меньше                                 | левая           | любые одинаковые | `__lt__`   |
| 5         | `<=`       | меньше или равно                       | левая           | любые одинаковые | `__le__`   |
| 5         | `>`        | больше                                 | левая           | любые одинаковые | `__gt__`   |
| 5         | `>=`       | больше или равно                       | левая           | любые одинаковые | `__ge__`   |
| 6         | `==`       | равно                                  | левая           | любые            | `__eq__`   |
| 6         | `!=`       | не равно                               | левая           | любые            | `__ne__`   |
| 7         | `&&`       | конъюнкция                             | левая           | любые            | —          |
| 8         | `\|\|`     | дизъюнкция                             | левая           | любые            | —          |
| 9         | `:`        | определение списка из головы и хвоста  | правая          | любой + список   | `__cons__` |

##### Вложенное выражение

Синтаксис:

```
"(", expression, ")"
```

##### Определение списка из набора элементов

Синтаксис:

```
"[", [expression, {",", expression}, [","]], "]"
```

Поддерживаются висящие запятые на конце списка элементов.

##### Вызов функции

Синтаксис:

```
identifier, "(", [expression, {",", expression}, [","]], ")"
```

Здесь `identifier` — имя функции.

Поддерживаются висящие запятые на конце списка аргументов.

##### Конъюнкция и дизъюнкция

Конъюнкция и дизъюнкция являются ленивыми операциями — они вычисляют правый операнд только при необходимости. При этом результатом данных операций является последний вычисленный операнд.

#### Точка входа

Интерпретатор асинхронно запускает все предоставленные акторы. После чего отправляет всем сообщение `__initialize__`.

#### Комментарии

Определение:

- однострочные — `/\/\/.*/`;
- многострочные — `/\/\*.*?\*\//s`.
