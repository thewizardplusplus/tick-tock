### ![](logo/logo.png) Общее описание

Tick-tock — интерпретируемый высокоуровневый язык программирования. Представляет собой конкурентную (по модели акторов) машину Тьюринга.

#### Исходники

Файлы исходного кода должны быть в кодировке UTF-8 и иметь концы строк как в UNIX (LF).

#### Ключевые слова

8 ключевых слов: `actor`, `state`, `message`, `let`, `send`, `set`, `return`, `when`.

#### Типы

Типизация: строгая динамическая.

Менеджмент памяти: сборка мусора.

##### Нулевой тип

Название: nil.

Тип: фиктивный тип; не хранит значение, а служит маркером его отсутствия; существует единственное значение данного типа.

Копирование: по значению.

Хранение: на стеке.

Определение: значение данного типа доступно через вызов функции рантайма `nil`.

##### Вещественные числа

Название: num.

Тип: с плавающей запятой, 8 байт.

Копирование: по значению.

Хранение: на стеке.

Определение:

- целые — `/\b((0x[\da-f]+)|(0[0-7]+)|(\d+(e\d+)?)|(\d+e[\+\-]\d+))\b/i`;
- вещественные — `/(\.\d+(e[\+\-]\d+)?)\b|\b\d+\.\d*((e[\+\-]\d+)?\b)?/i`;
- символы — `/'(\\x[\da-f]{2}|\\.|[^'\n])'/i`.

##### Списки

Название: list.

Тип: LISP-подобный список &mdash; или пустой список, или пара из головы и хвоста, где голова может иметь любой тип (и является хранимым элементом), а хвост является аналогичным списком.

Копирование: по ссылке.

Хранение:

- ссылки &mdash; на стеке;
- значения &mdash; в куче.

Определение:

- пустого списка &mdash; через оператор `[...]` или вызов функции рантайма `__empty_list__`;
- списка из головы и хвоста &mdash; через оператор `:` или вызов функции рантайма `__cons__`;
- списка из набора элементов &mdash; через оператор `[...]`.

Доступ к элементам:

- к количеству элементов &mdash; через вызов функции рантайма `size`;
- к голове списка &mdash; через вызов функции рантайма `head`;
- к хвосту списка &mdash; через вызов функции рантайма `tail`;
- к элементу по индексу &mdash; через оператор `...[...]` или вызов функции рантайма `__item__`.

##### Строки

Строками являются списки, хранящие коды символов. Используется кодировка UTF-32.

Определение:

- интерпретируемые:
  - в одинарных кавычках — `/'(\\x[\da-f]{2}|\\.|[^'\n])*?'/i`;
  - в двойных кавычках — `/"(\\x[\da-f]{2}|\\.|[^"\n])*?"/i`;
- сырые — `` /`[^`]*?`/ ``.

В интерпретируемых преобразуются управляющие последовательности.

Строки в одинарных кавычках допускаются, только если они длиннее 1 символа.

##### Логический тип

В качестве значений логического типа используются значения других типов:

- ложным логическим значением являются:
  - значение `nil`;
  - число 0;
  - пустой список;
- истинным логическим значением являются:
  - числа, отличные от 0;
  - непустые списки.

#### Сущности

##### Обработчики сообщений

Содержат имя обрабатываемого сообщения, список параметров обрабатываемого сообщения и список команд, которые необходимо выполнить при получении данного сообщения.

Объявление:

```
"message", identifier, "(", [identifier, {",", identifier}, [","]], ")",
  {command},
";"
```

Здесь первый `identifier` — имя обрабатываемого сообщения. Остальные `identifier` — имена параметров обрабатываемого сообщения.

Если число отправленных аргументов больше числа объявленных параметров, лишние аргументы отбрасываются. Если число отправленных аргументов меньше числа объявленных параметров, параметры, которым не хватает аргументов, получают значение `nil`.

Поддерживается висящая запятая на конце списка параметров.

##### Состояния акторов

Содержат имя состояния актора, список параметров состояния актора и список обработчиков сообщений, относящихся к этому состоянию.

Объявление:

```
"state", identifier, "(", [identifier, {",", identifier}, [","]], ")",
  {message},
";"
```

Здесь первый `identifier` — имя состояния актора. Остальные `identifier` — имена параметров состояния актора.

Если число установленных аргументов больше числа объявленных параметров, лишние аргументы отбрасываются. Если число установленных аргументов меньше числа объявленных параметров, параметры, которым не хватает аргументов, получают значение `nil`.

Поддерживается висящая запятая на конце списка параметров.

##### Акторы

Представляют собой зелёные (легковесные) потоки. Содержат список поддерживаемых состояний. По умолчанию находятся в состоянии `__initialization__`.

Объявление:

```
"actor", identifier,
  state, {state},
";"
```

Здесь `identifier` — имя актора.

#### Команды

##### Команда `let`

Вычисляет выражение, результат вычисления устанавливает указанной переменной. Если такой переменной ещё нет, то она будет объявлена. Изменение значения переменной, равно как и её объявление, имеет эффект только ниже текущей команды. Операция синхронная.

Синтаксис:

```
"let", identifier, "=", expression
```

Здесь `identifier` — имя переменной.

Результатом команды является значение выражения.

##### Команда `send`

Отправляет всем акторам указанное сообщение с указанными аргументами. Операция асинхронная.

Синтаксис:

```
"send", identifier, "(", [expression, {",", expression}, [","]], ")"
```

Здесь `identifier` — имя сообщения. Список `expression` — список выражений, результаты вычисления которых используются в качестве аргументов сообщения.

Поддерживается висящая запятая на конце списка выражений.

Результатом команды является значение `nil`.

##### Команда `set`

Устанавливает текущему актору указанное состояние с указанными аргументами. Операция синхронная.

Синтаксис:

```
"set", identifier, "(", [expression, {",", expression}, [","]], ")"
```

Здесь `identifier` — имя состояния. Список `expression` — список выражений, результаты вычисления которых используются в качестве аргументов состояния.

Поддерживается висящая запятая на конце списка выражений.

Результатом команды является значение `nil`.

##### Команда `return`

Прерывает выполнение команд текущего обработчика сообщений.

Синтаксис:

```
"return"
```

Результатом команды является значение `nil`.

##### Выражение

Выражение может выступать в роли команды. В этом случае оно просто вычисляется, а результат вычисления отбрасывается. Может использоваться ради побочных эффектов вычисления. Операция синхронная.

Результатом команды является значение выражения.

#### Операции

Перечислены в порядке убывания приоритета.

| Приоритет | Операция   | Описание                               | Ассоциативность | Типы             | Функция    |
| --------- | ---------- | -------------------------------------- | --------------- | ---------------- | ---------- |
| 0         | `(...)`    | вложенное выражение                    | —               | —                | —          |
| 0         | `[...]`    | определение списка из набора элементов | —               | —                | —          |
| 0         | `...(...)` | вызов функции                          | —               | —                | —          |
| 0         | `when...;` | условное выражение                     | —               | —                | —          |
| 1         | `...[...]` | доступ к элементам списка              | левая           | список + число   | `__item__` |
| 2         | `-`        | унарный минус                          | правая          | число            | `__neg__`  |
| 2         | `!`        | логическое отрицание                   | правая          | любой            | `__not__`  |
| 3         | `*`        | умножение                              | левая           | числа            | `__mul__`  |
| 3         | `/`        | деление                                | левая           | числа            | `__div__`  |
| 3         | `%`        | остаток от деления                     | левая           | числа            | `__mod__`  |
| 4         | `+`        | сложение/конкатенация                  | левая           | числа/списки     | `__add__`  |
| 4         | `-`        | вычитание                              | левая           | числа            | `__sub__`  |
| 5         | `<`        | меньше                                 | левая           | любые одинаковые | `__lt__`   |
| 5         | `<=`       | меньше или равно                       | левая           | любые одинаковые | `__le__`   |
| 5         | `>`        | больше                                 | левая           | любые одинаковые | `__gt__`   |
| 5         | `>=`       | больше или равно                       | левая           | любые одинаковые | `__ge__`   |
| 6         | `==`       | равно                                  | левая           | любые            | `__eq__`   |
| 6         | `!=`       | не равно                               | левая           | любые            | `__ne__`   |
| 7         | `&&`       | конъюнкция                             | левая           | любые            | —          |
| 8         | `\|\|`     | дизъюнкция                             | левая           | любые            | —          |
| 9         | `:`        | определение списка из головы и хвоста  | правая          | любой + список   | `__cons__` |

##### Вложенное выражение

Синтаксис:

```
"(", expression, ")"
```

##### Определение списка из набора элементов

Синтаксис:

```
"[", [expression, {",", expression}, [","]], "]"
```

Здесь список `expression` — список выражений, результаты вычисления которых используются в качестве элементов списка.

Поддерживается висящая запятая на конце списка выражений.

##### Вызов функции

Синтаксис:

```
identifier, "(", [expression, {",", expression}, [","]], ")"
```

Здесь `identifier` — имя функции. Список `expression` — список выражений, результаты вычисления которых используются в качестве аргументов функции.

Поддерживается висящая запятая на конце списка выражений.

##### Условное выражение

Синтаксис:

```
"when",
  {conditional case},
";"
```

Здесь `conditional case` — ветка условия.

Синтаксис ветки условия:

```
"=>", expression,
  {command}
```

При вычислении условного выражения ветки условия вычисляются последовательно одна за другой до тех пор, пока выражение в ветке не будет истинным. Если такая ветка будет найдена, вычисление веток останавливается, и начинают выполняться команды в найденной ветке. Результат последней выполненной команды будет возвращён как результат условного выражения.

##### Конъюнкция и дизъюнкция

Конъюнкция и дизъюнкция являются ленивыми операциями — они вычисляют правый операнд только при необходимости. При этом результатом данных операций является последний вычисленный операнд.

#### Точка входа

Интерпретатор асинхронно запускает все предоставленные акторы. После чего отправляет всем сообщение `__initialize__`.

#### Комментарии

Определение:

- однострочные — `/\/\/.*/`;
- многострочные — `/\/\*.*?\*\//s`.
